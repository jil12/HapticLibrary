<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:vm="using:HapticLibrary.ViewModels"
			 xmlns:m="using:HapticLibrary.Models"
			 xmlns:converters="using:HapticLibrary.Converters"
			 mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
			 x:DataType="vm:HapticEditorViewModel"
             x:Class="HapticLibrary.Views.HapticEditorView"
			 x:Name="HapticEditor">
	<UserControl.Resources>
		<converters:DrawingColorToBrushConverter x:Key="ColorBrushConverter"/>
		<converters:EditorWordToBrushConverter x:Key="EditorWordToBrushConverter"/>
		<StaticResource x:Key="AppGradientBrush" ResourceKey="AppGradientBrush"/>
	</UserControl.Resources>
	<UserControl.Styles>
		<Style Selector="Button.df_button">
			<Setter Property="Foreground" Value="#131313"/>
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="Padding" Value="10,0,40,0"/>
			<Setter Property="CornerRadius" Value="10"/>
			<Setter Property="Background">
				<LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
					<GradientStop Color="#a0d2ae" Offset="0"/>
					<GradientStop Color="#77afc9" Offset="1"/>
				</LinearGradientBrush>
			</Setter>
			<Setter Property="FontFamily" Value="Arial, sans-serif"/>
			<Setter Property="Margin" Value="0,40,0,0"/>
		</Style>
	</UserControl.Styles>

    <Grid RowDefinitions="Auto,*">
        <!-- Header -->
        <Border Grid.Row="0" Background="White" BorderBrush="#E9ECEF" BorderThickness="0,0,0,1" Padding="30,8" Height="65">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="16" Grid.Column="0">
                    <TextBlock Text="Haptic Editor" FontSize="28" FontWeight="SemiBold" Foreground="#333333"/>
                </StackPanel>
                <Button Content="Export Book" Command="{Binding ExportBookCommand}" Width="160" Height="40" Margin="0,0,0,0" Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center" Classes="text-btn"/>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="1" Background="#F8F9FA">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Centered Editor Content -->
            <StackPanel Grid.Column="0" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="32">
                <!-- Page Navigation -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="12">
                    <Button Classes="page-flip-btn" Command="{Binding PrevPageCommand}" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="20,0,0,0">
                        <PathIcon Data="{StaticResource icon_chevron_left}" Width="24" Height="24" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                    <TextBlock Text="Page" FontSize="18" FontWeight="SemiBold" Foreground="#333333" VerticalAlignment="Center"/>
                    <Button Classes="page-flip-btn" Command="{Binding NextPageCommand}" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,20,0">
                        <PathIcon Data="{StaticResource icon_chevron_right}" Width="24" Height="24" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                </StackPanel>

                <!-- Word Panel -->
                <Border Background="White" Opacity="0.95" CornerRadius="24" Padding="30" Width="800" Height="300" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <ScrollViewer MaxHeight="300">
                        <ItemsControl ItemsSource="{Binding Words}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel HorizontalAlignment="Center"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:EditorWordViewModel">
                                    <Button Content="{Binding Word}" Margin="2"
                                            Command="{Binding DataContext.SelectWordCommand, ElementName=HapticEditor}"
                                            CommandParameter="{Binding}"
                                            HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                                            Foreground="Black"
                                            Background="{Binding, Converter={StaticResource EditorWordToBrushConverter}}"
                                            FontSize="16"
                                            CornerRadius="12"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Border>

                <!-- Pattern Panel -->
                <Border Background="#F5F5F7" CornerRadius="16" Padding="20" Width="800" HorizontalAlignment="Center">
                    <StackPanel>
                        <TextBlock Text="Haptic Patterns" FontSize="20" FontWeight="SemiBold" Foreground="#333333" Margin="0,0,0,12"/>
                        <ItemsControl ItemsSource="{Binding Patterns}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel HorizontalAlignment="Left"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="m:HapticPattern">
                                                                <Button Content="{Binding Name}" Margin="2"
                                    Command="{Binding DataContext.SelectPatternCommand, ElementName=HapticEditor}"
                                    CommandParameter="{Binding}"
                                    Width="60" Height="60"
                                    HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                                    Background="{Binding Color, Converter={StaticResource ColorBrushConverter}}"
                                    FontWeight="Medium"
                                    CornerRadius="12"
                                    Classes="text-btn"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Properties/Editor Sidebar -->
            <Border Grid.Column="1" Background="White" BorderBrush="#E9ECEF" BorderThickness="1,0,0,0" Padding="24" MinWidth="320" CornerRadius="0,24,24,0">
                <StackPanel Spacing="24" HorizontalAlignment="Left">
                    <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Left">
                        <ToggleButton Content="Pattern" IsChecked="{Binding IsPatternEditing}" Command="{Binding EnablePatternEditingCommand}" Width="100" HorizontalAlignment="Left"/>
                        <ToggleButton Content="Text" IsChecked="{Binding IsTextEditing}" Command="{Binding EnableTextEditingCommand}" Width="100" HorizontalAlignment="Left"/>
                    </StackPanel>
                    <Panel IsVisible="{Binding IsPatternEditing}">
                        <StackPanel Spacing="12" HorizontalAlignment="Stretch">
                            <TextBlock Text="Haptic Pattern Properties" FontSize="18" FontWeight="SemiBold" HorizontalAlignment="Left"/>
                            <TextBlock Text="Name:" HorizontalAlignment="Left"/>
                            <TextBox Name="NameTextBox" Width="200" Text="{Binding HapticName}" HorizontalAlignment="Left"/>
                            <TextBlock Text="Color (R, G, B):" HorizontalAlignment="Left"/>
                            <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Left">
                                <TextBox Name="RedTextBox" Width="50" Tag="0,255,HapticRed" TextInput="IntBox_TextInput" LostFocus="IntBox_OnLostFocus" HorizontalAlignment="Left"/>
                                <TextBox Name="GreenTextBox" Width="50" Tag="0,255,HapticGreen" TextInput="IntBox_TextInput" LostFocus="IntBox_OnLostFocus" HorizontalAlignment="Left"/>
                                <TextBox Name="BlueTextBox" Width="50" Tag="0,255,HapticBlue" TextInput="IntBox_TextInput" LostFocus="IntBox_OnLostFocus" HorizontalAlignment="Left"/>
                            </StackPanel>
                            <TextBlock Text="Temperature (-1 to 1):" HorizontalAlignment="Left"/>
                            <TextBox Name="TemperatureTextBox" Width="200" Tag="-1,1,HapticTemperature" TextInput="FloatBox_TextInput" LostFocus="FloatBox_OnLostFocus" HorizontalAlignment="Left"/>
                            <TextBlock Text="Vibration (0 to 1):" HorizontalAlignment="Left"/>
                            <TextBox Name="VibrationTextBox" Width="200" Tag="0,1,HapticVibration" TextInput="FloatBox_TextInput" LostFocus="FloatBox_OnLostFocus" HorizontalAlignment="Left"/>
                            <Grid ColumnDefinitions="Auto,8,Auto" Margin="0,16,0,0" HorizontalAlignment="Left">
                                <Button Grid.Column="0" Command="{Binding CreateHapticPatternCommand}" Width="120" Height="44" Classes="text-btn">Create Pattern</Button>
                                <Button Grid.Column="2" Command="{Binding NewPageCommand}" Width="120" Height="44" Classes="text-btn">Add Page</Button>
                            </Grid>
                        </StackPanel>
                    </Panel>
                    <Panel IsVisible="{Binding IsTextEditing}">
                        <StackPanel Spacing="12" HorizontalAlignment="Left">
                            <TextBlock Text="Edit Page" FontSize="18" FontWeight="SemiBold" HorizontalAlignment="Left"/>
                            <TextBox Margin="0,12" Text="{Binding EditableText}" AcceptsReturn="True" Height="120" HorizontalAlignment="Left"/>
                            <Button Content="Update Text" Command="{Binding SaveTextCommand}" Width="160" Height="44" HorizontalAlignment="Left" Classes="text-btn"/>
                        </StackPanel>
                    </Panel>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
